[
  {
    "from": "spec-investigator",
    "text": "## Spec Investigation: 3 Implementation Issues\n\nI've read all the relevant spec files. Here are my findings for each issue.\n\n---\n\n## Issue 1: Gemini Model ID Discrepancy\n\n### What the spec says (exact quotes)\n\n**`spec/research-team/agent-config.yaml:124-125`** (Platform Synthesizer):\n```yaml\nmodel:\n  provider: google\n  name: gemini-3-flash\n```\n\n**`spec/research-team/agent-config.yaml:144-145`** (Signal Blender):\n```yaml\nmodel:\n  provider: google\n  name: gemini-3-pro\n```\n\n**`spec/ideation-team/agent-config.yaml:29-30`** (Expert Panel):\n```yaml\nmodel:\n  provider: google\n  name: gemini-3-flash\n```\n\n**`spec/ideation-team/agent-config.yaml:50-51`** (Idea Drafter):\n```yaml\nmodel:\n  provider: google\n  name: gemini-3-pro\n```\n\n**`spec/progress.md:170-171`** (LLM Configuration section):\n```\nDefault model: Gemini 3 Flash (fast, cost-effective for most agents)\nPro model: Gemini 3 Pro (for complex reasoning: Critic, Selection Agent, Signal Blender)\n```\n\n**`spec/research-team/team.md:95`** (Pattern 3 description):\n```\nResearcher Agent uses `gemini/gemini-3-flash-preview` with `tools=[{\"googleSearch\": {}}]`\n```\n\n**`spec/research-team/team.md:322`** (Notes section):\n```\ndspy.LM(\"gemini/gemini-3-flash-preview\", tools=[{\"googleSearch\": {}}])\n```\n\n### Answers\n\n1. **Model names in spec:** The agent-config.yaml files use short form: `gemini-3-flash` and `gemini-3-pro`. The research-team/team.md uses DSPy path form: `gemini/gemini-3-flash-preview` (only for grounding).\n2. **Short form or DSPy path form?** agent-config.yaml uses short form (`gemini-3-flash`). The team.md uses DSPy path form (`gemini/gemini-3-flash-preview`) but ONLY in the context of Industry Research grounding. No other agent has the DSPy path form specified.\n3. **Does the spec mention \"preview\" suffix?** YES — but ONLY for the grounded Gemini calls in Industry Research. The `-preview` suffix appears at `team.md:95` and `team.md:322`. It does NOT appear in any agent-config.yaml file.\n4. **Root cause:** **Spec ambiguity + API naming knowledge gap.** The spec uses informal short names (`gemini-3-flash`, `gemini-3-pro`) in the config files, which don't map to real API model IDs. The only place with a real API-compatible model ID is the Industry Research section (`gemini/gemini-3-flash-preview`). The implementation had to guess the full model IDs from short names, and guessed wrong (`gemini-2.5-flash`/`gemini-2.5-pro` instead of `gemini-3-flash-preview`/`gemini-3-pro-preview`).\n\n### Spec update needed?\n**YES.** The agent-config.yaml files should use the actual DSPy LM path format (`gemini/gemini-3-flash-preview`, `gemini/gemini-3-pro-preview`) rather than informal short names. The spec was inconsistent — it used real model IDs in one place (team.md for grounding) but informal names everywhere else.\n\n---\n\n## Issue 2: X Creator Actor Input Schema\n\n### What the spec says (exact quotes)\n\n**`spec/research-team/x-creator/team.md:169-172`** (Input Parameters table):\n```\n| Field | Type | Required | Description | Default | Max |\n|-------|------|----------|-------------|---------|-----|\n| `username` | String or Array | Yes | Twitter username(s) WITHOUT @ symbol | - | - |\n| `max_posts` | Integer | No | Max posts per timeline | **50** | 200 |\n```\n\n**`spec/research-team/x-creator/team.md:174-177`** (Username format):\n```\nUsername format:\n- Correct: `\"elonmusk\"` or `[\"elonmusk\", \"openai\"]`\n- Incorrect: `\"@elonmusk\"`\n- Batch all usernames in a single array for efficient multi-creator fetching\n```\n\n**`spec/research-team/x-creator/team.md:96-103`** (Fetch step code example):\n```python\nrun = client.actor(\"danek/twitter-timeline-ppr\").call(\n    run_input={\n        \"username\": handles,  # Array, WITHOUT @ symbol\n        \"max_posts\": 50       # Over-sample\n    }\n)\n```\n\n**`spec/research-team/agent-config.yaml:52`** (x-creator notes):\n```\nBatch username input, thread detection. Independent implementation.\n```\n\n### Answers\n\n1. **Does the spec document the actor input schema?** YES, extensively. The team.md has a full Input Parameters table (line 169) and a code example (line 96-103).\n2. **Does it say `username` is a string or list?** The spec says **\"String or Array\"** in the type column, shows both forms as correct (`\"elonmusk\"` or `[\"elonmusk\", \"openai\"]`), and the code example passes `handles` (a list) directly. The spec says \"Batch all usernames in a single array.\"\n3. **Does it mention the over-sampling strategy?** YES. The spec explicitly says \"Over-sample 50 posts per creator handle\" and shows `max_posts: 50` in the code.\n4. **Root cause:** **Implementation worked as the spec described, but the spec was wrong about the actor's actual API.** The spec says the `username` field accepts \"String or Array\" and the code example passes an array. In reality, the actor `danek/twitter-timeline-ppr` only accepts a single string for `username`. The spec documented the actor incorrectly — it assumed batch input was supported when it wasn't.\n\n### Spec update needed?\n**YES.** The spec should be corrected:\n- Change `username` type from \"String or Array\" to \"String\"\n- Remove the batch array example `[\"elonmusk\", \"openai\"]`\n- Remove \"Batch all usernames in a single array\" guidance\n- Update the code example to show one call per username with a loop\n- Update the agent-config.yaml note to remove \"Batch username input\"\n\n---\n\n## Issue 3: Research Documents Not in API Response\n\n### What the spec says (exact quotes)\n\n**`spec/progress.md:125-126`** (Journey Mapping, step 8):\n```\n8. Output: IdeationOutput (campaigns + standalone posts) + research documents\n```\n\n**`spec/progress.md:146-148`** (Inputs & Outputs section):\n```\nOutputs:\n- `IdeationOutput` — campaigns: list[CampaignIdeaOutput], standalone_posts: list[StandalonePostOutput]\n- Research documents — PlatformDocument (LinkedIn, X), Industry Doc, Analytics Doc, Signal Blender output\n- All outputs as JSON (for DB/frontend) and markdown (for downstream agents)\n```\n\n**`spec/progress.md:62`** (Decision #21):\n```\n| 21 | Research docs | User-facing, dual format | JSON for frontend expandable views, markdown for agent consumption |\n```\n\n**`spec/research-team/team.md:13`** (Purpose):\n```\nResults flow through platform synthesizers and a signal blender to produce 5 user-facing research documents.\n```\n\n**`spec/research-team/team.md:305-307`** (Orchestration Step 5):\n```\nSTEP 5: Return all 5 documents\n  return linkedin_doc, x_doc, industry_output, analytics_output, blended_insights\n```\n\n**`spec/manifest.yaml:469-472`** (root-pipeline chunk):\n```\nRoot DSPy Module: Research Phase → Ideation Phase sequential pipeline.\nChains research-phase-orchestrator output into ideation-pipeline-module input.\nTop-level error handling, timing, and logging.\n```\n\n**`spec/manifest.yaml:480-486`** (fastapi-wrapper chunk):\n```\nFastAPI service wrapper:\n- POST /generate-ideas endpoint (receives Backend API request)\n- GET /health endpoint\n- Request/response models matching Backend API contract\n- Async execution of the root pipeline\n- Timing instrumentation\n```\n\n**`spec/manifest.yaml:757-760`** (full-pipeline-test structural checks):\n```\n- Response has refined_ideas, research_summary, timings, error fields\n- research_summary is non-empty markdown (at least 500 words)\n```\n\n### Answers\n\n1. **Does the spec explicitly say research documents should be returned to the API caller?** PARTIALLY. The progress.md (line 125-126) says the output is \"IdeationOutput + research documents.\" Decision #21 says research docs are \"User-facing, dual format.\" The test spec expects `research_summary` in the response. But the fastapi-wrapper chunk description (manifest.yaml:480-486) does NOT mention returning research documents — it only says \"Request/response models matching Backend API contract.\"\n2. **What does the spec say about research document outputs?** The research-team/team.md (line 13) says they produce \"5 user-facing research documents.\" The orchestration sequence (line 305-307) returns all 5 documents. Progress.md lists them as system outputs. Decision #21 explicitly marks them as \"User-facing.\"\n3. **Is there ambiguity between \"outputs\" (internal) vs \"API response\"?** YES, there is a gap. The spec is clear that research docs are generated and are user-facing. But the fastapi-wrapper chunk in manifest.yaml doesn't specify the response schema. The root-pipeline chunk says it \"chains research output into ideation input\" but doesn't say \"and also returns research docs to the caller.\" The full-pipeline-test expects `research_summary` in the response — which tells us the intent was there, but the implementation spec (fastapi-wrapper) didn't spell it out.\n4. **Root cause:** **Spec ambiguity — intent was clear but implementation instructions were incomplete.** The spec clearly intended research docs to be user-facing (Decision #21, progress.md outputs, test expectations). But the fastapi-wrapper chunk and root-pipeline chunk in manifest.yaml didn't explicitly say \"include research documents in the API response.\" The implementation followed the manifest.yaml execution plan literally, which didn't mention returning research docs from the API.\n\n### Spec update needed?\n**YES.** The manifest.yaml should be updated:\n- `root-pipeline` chunk: Add \"Returns both IdeationOutput and research documents\"\n- `fastapi-wrapper` chunk: Add \"Response includes `research_documents` (5 research docs) alongside `refined_ideas`\"\n- Optionally define the response schema explicitly in the fastapi-wrapper description\n\n---\n\n## Summary Table\n\n| Issue | Root Cause | Spec Needs Update? |\n|-------|-----------|-------------------|\n| 1. Gemini Model IDs | **Spec ambiguity** — informal short names in config, real IDs only in one place | YES — use actual DSPy LM path format everywhere |\n| 2. X Creator Actor Schema | **Spec error** — documented `username` as \"String or Array\" but actor only accepts String | YES — correct the type, remove batch examples, add per-username loop |\n| 3. Research Docs in Response | **Spec ambiguity** — intent clear (user-facing, in test expectations) but implementation instructions incomplete | YES — add explicit response schema to root-pipeline and fastapi-wrapper chunks |\n",
    "summary": "Complete analysis of 3 implementation issues with spec quotes and root causes",
    "timestamp": "2026-02-11T16:30:05.842Z",
    "color": "blue",
    "read": true
  },
  {
    "from": "spec-investigator",
    "text": "{\"type\":\"idle_notification\",\"from\":\"spec-investigator\",\"timestamp\":\"2026-02-11T16:30:11.457Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-11T16:30:11.458Z",
    "color": "blue",
    "read": true
  },
  {
    "from": "spec-investigator",
    "text": "{\"type\":\"idle_notification\",\"from\":\"spec-investigator\",\"timestamp\":\"2026-02-11T16:30:19.853Z\",\"idleReason\":\"available\"}",
    "timestamp": "2026-02-11T16:30:19.853Z",
    "color": "blue",
    "read": true
  },
  {
    "from": "spec-investigator",
    "text": "{\"type\":\"shutdown_approved\",\"requestId\":\"shutdown-1770828720217@spec-investigator\",\"from\":\"spec-investigator\",\"timestamp\":\"2026-02-11T16:52:04.186Z\",\"paneId\":\"%36\",\"backendType\":\"tmux\"}",
    "timestamp": "2026-02-11T16:52:04.186Z",
    "color": "blue",
    "read": true
  }
]