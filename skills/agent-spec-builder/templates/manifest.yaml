# System Manifest
# Entry point for implementation. impl-builder reads this first.
#
# This file provides:
# 1. System overview and type
# 2. Hierarchy visualization
# 3. File locations (all paths relative to spec/)

system:
  name: [system-name]
  type: [single-agent | agent-team | nested-teams]
  description: |
    Brief description of what this system does.

# =============================================================================
# HIERARCHY
# Shows the structure visually. Each team folder is self-contained.
# Agent specs live in agents/ subdirectory within each team.
# =============================================================================

hierarchy:
  # SINGLE AGENT example:
  # root:
  #   type: agent
  #   file: my-agent.md
  #   config: agent-config.yaml

  # SINGLE TEAM example:
  # content-review-loop:
  #   type: team
  #   pattern: loop
  #   folder: content-review-loop/
  #   files:
  #     team: team.md
  #     config: agent-config.yaml
  #   agents:
  #     - creator:
  #         file: agents/creator.md
  #     - critic:
  #         file: agents/critic.md

  # NESTED TEAMS example (2-level):
  # research-pipeline:
  #   type: team
  #   pattern: pipeline
  #   folder: research-pipeline/
  #   files:
  #     team: team.md
  #     config: agent-config.yaml
  #   sub-teams:
  #     - content-refinement:
  #         type: team
  #         pattern: loop
  #         folder: research-pipeline/content-refinement/
  #         files:
  #           team: team.md
  #           config: agent-config.yaml
  #         agents:
  #           - creator:
  #               file: agents/creator.md
  #           - critic:
  #               file: agents/critic.md
  #     - parallel-research:
  #         type: team
  #         pattern: fan-in-fan-out
  #         folder: research-pipeline/parallel-research/
  #         files:
  #           team: team.md
  #           config: agent-config.yaml
  #         agents:
  #           - researcher-a:
  #               file: agents/researcher-a.md
  #           - researcher-b:
  #               file: agents/researcher-b.md
  #           - merger:
  #               file: agents/merger.md

  # 3-LEVEL NESTING example:
  # When a parent team orchestrates sub-teams that themselves contain sub-teams.
  # Each level has its own team.md, agent-config.yaml, and pattern annotation.
  #
  # root-pipeline:
  #   type: team
  #   pattern: pipeline
  #   folder: root-pipeline/
  #   files:
  #     team: team.md
  #     config: agent-config.yaml
  #   sub-teams:
  #     - research-phase:
  #         type: team
  #         pattern: fan-in-fan-out
  #         folder: root-pipeline/research-team/
  #         files:
  #           team: team.md
  #           config: agent-config.yaml
  #         agents:                          # Direct agents at level 2
  #           - synthesizer:
  #               file: agents/synthesizer.md
  #         sub-teams:                       # Level 3 sub-teams
  #           - keyword-loop:
  #               type: team
  #               pattern: loop
  #               folder: root-pipeline/research-team/keyword-loop/
  #               files:
  #                 team: team.md
  #                 config: agent-config.yaml
  #               agents:
  #                 - search-agent:
  #                     file: agents/search-agent.md
  #                 - analysis-agent:
  #                     file: agents/analysis-agent.md
  #           - analytics-team:
  #               type: team
  #               pattern: fan-in-fan-out
  #               folder: root-pipeline/research-team/analytics-team/
  #               files:
  #                 team: team.md
  #                 config: agent-config.yaml
  #               agents:
  #                 - analyst-a:
  #                     file: agents/analyst-a.md
  #                 - analyst-b:
  #                     file: agents/analyst-b.md

  # TEMPLATE-TO-INSTANCES example:
  # When multiple sub-teams share the same structure but differ in config
  # (e.g., platform-specific research loops), list each instance as a
  # SEPARATE entry. Do NOT group them under the template.
  # The template folder is listed with note: "TEMPLATE — not instantiated directly"
  #
  # research-team:
  #   type: team
  #   pattern: fan-in-fan-out
  #   folder: research-team/
  #   files:
  #     team: team.md
  #     config: agent-config.yaml
  #   sub-teams:
  #     - research-loop:
  #         type: team
  #         pattern: loop
  #         folder: research-team/research-loop/
  #         note: "TEMPLATE — generic structure. Platform instances below are self-contained."
  #         files:
  #           team: team.md
  #           config: agent-config.yaml
  #         agents:
  #           - search-agent:
  #               file: agents/search-agent.md
  #           - analysis-agent:
  #               file: agents/analysis-agent.md
  #     - linkedin-keyword:                # Instance 1 — fully explicit
  #         type: team
  #         pattern: loop
  #         folder: research-team/linkedin-keyword/
  #         files:
  #           team: team.md
  #           config: agent-config.yaml
  #         agents:
  #           - linkedin-keyword-search-agent:
  #               file: agents/linkedin-keyword-search-agent.md
  #           - linkedin-keyword-analysis-agent:
  #               file: agents/linkedin-keyword-analysis-agent.md
  #     - x-keyword:                       # Instance 2 — fully explicit
  #         type: team
  #         pattern: loop
  #         folder: research-team/x-keyword/
  #         files:
  #           team: team.md
  #           config: agent-config.yaml
  #         agents:
  #           - x-keyword-search-agent:
  #               file: agents/x-keyword-search-agent.md
  #           - x-keyword-analysis-agent:
  #               file: agents/x-keyword-analysis-agent.md

# =============================================================================
# FILES
# Complete list of all spec files for easy traversal
# All paths relative to spec/
# =============================================================================

files:
  root:
    - manifest.yaml
    - progress.md

  # List all team folders and their contents
  teams:
    # - folder: content-review-loop/
    #   files:
    #     - team.md
    #     - agent-config.yaml
    #   agents:
    #     - agents/creator.md
    #     - agents/critic.md

    # For nested:
    # - folder: research-pipeline/
    #   files:
    #     - team.md
    #     - agent-config.yaml
    #   sub-teams:
    #     - folder: research-pipeline/content-refinement/
    #       files:
    #         - team.md
    #         - agent-config.yaml
    #       agents:
    #         - agents/creator.md
    #         - agents/critic.md

# =============================================================================
# EXECUTION PLAN
# Phases execute sequentially. Chunks within a phase execute in parallel.
# Work streams group related chunks for context continuity across phases.
# The implementation agent uses this to orchestrate a team of agents.
#
# Key concepts:
#   Phase  = sequential barrier. Next phase starts when ALL chunks complete.
#   Chunk  = unit of work within a phase. All chunks run in parallel.
#   Stream = group of related chunks across phases. Same agent handles a
#            stream's chunks to retain context (agents have own context windows).
#
# Maps to Claude Code agent teams:
#   - TaskCreate per chunk, blockedBy for phase/chunk deps
#   - One teammate per stream (context continuity)
#   - SendMessage for inter-stream communication
# =============================================================================

execution-plan:
  # Work streams — related chunks assigned to the same agent for context
  # continuity. The implementation agent decides actual agent types at runtime.
  # Skills tell each stream's agent what skills to load before working.
  #
  # IMPORTANT: Each team stream owns its FULL directory — modules, signatures,
  # AND prompts. Do NOT create a separate "signatures" or "prompts" stream.
  # The teammate that builds the module also writes its signatures.py and
  # prompts/*.md files, because they have the most context. Include
  # prompt-engineering in each team stream's skills list.
  #
  # streams:
  #   - name: scaffold
  #     responsibility: Orchestration, utilities, service wrapper
  #     owns: [src/pipeline.py, src/utils/, main.py, .env.example]
  #     skills: [agent-teams]
  #   - name: tools
  #     responsibility: Tool implementation from agent spec documentation
  #     owns: [src/tools/]
  #     skills: [tools-and-utilities]
  #   - name: my-team
  #     responsibility: Team modules, signatures, and prompts
  #     owns: [src/my_team/]
  #     skills: [agent-teams, individual-agents, prompt-engineering]

  # Phases — sequential barriers. All chunks in a phase run in parallel.
  # Chunk-level dependencies can also be specified via depends_on.
  #
  # IMPORTANT: Each chunk MUST include `spec-files` — the exact spec file paths
  # to read for that chunk. This tells the impl-builder which files contain the
  # requirements for each unit of work. All paths are relative to spec/.
  #
  # NOTE: Signatures and prompts are built as part of each team's module chunks,
  # NOT in a separate phase. Each team chunk produces:
  #   - team.py (orchestration)
  #   - signatures.py (DSPy Signature classes with empty docstrings)
  #   - prompts/*.md (prompt content loaded into __doc__ at runtime)
  #
  # phases:
  #   - phase: 1
  #     name: Foundation
  #     chunks:
  #       - name: tools
  #         stream: tools
  #         description: Implement tool definitions from agent specs
  #         spec-files:
  #           - content-review-loop/agents/creator.md    # Tool specs in agent files
  #           - content-review-loop/agents/critic.md
  #
  #   - phase: 2
  #     name: Team Implementation
  #     chunks:
  #       - name: implement-team
  #         stream: my-team
  #         description: |
  #           Build team module, signatures, and prompts:
  #           - team.py with orchestration logic
  #           - signatures.py with typed InputField/OutputField definitions
  #           - prompts/*.md with XML-tagged prompt content per agent
  #         spec-files:
  #           - content-review-loop/team.md
  #           - content-review-loop/agent-config.yaml
  #           - content-review-loop/agents/creator.md
  #           - content-review-loop/agents/critic.md
  #
  #   - phase: 3
  #     name: Finalization
  #     chunks:
  #       - name: utilities
  #         stream: scaffold
  #         description: Create shared utilities if needed
  #         spec-files:
  #           - content-review-loop/team.md
  #       - name: env-setup
  #         stream: scaffold
  #         description: Generate .env.example
  #         spec-files:
  #           - content-review-loop/team.md               # Dependencies section
  #       - name: fastapi-wrapper
  #         stream: scaffold
  #         description: Create FastAPI service wrapper
  #         spec-files:
  #           - manifest.yaml                             # System-level config

  # Communication — what agents need to share between streams.
  # Defines WHAT to communicate, not the exact messages.
  #
  # communication:
  #   - from: tools
  #     to: my-team
  #     after: phase-1
  #     what: Tool function signatures and return types for agent implementations
